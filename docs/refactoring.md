# 重構
## 定義
在不改變程式碼外在行為的前提下，對程式碼做出修改，以改進程序的內部結構，提高可理解性，降低修改成本。

## 注意事項
- 如果發現自己需要為程序添加一個特性，而結構使你無法很方便地達成目的，那就先重構那個程序，讓添加特性比較容易，最後再添加。
- 重構技術就是以微小的步伐修改程序。如果犯下錯誤，很容易就可以發現。
- 任何一個傻瓜都能寫出電腦可以理解的程式碼。唯有寫出人類容易理解的程式碼，才是優秀的程序員。
- 不要一邊添加新功能一邊重構，兩者是截然不同的。添加新功能時，不應該修改既有程式碼，只管添加新功能；重構時，不能再添加功能，只管改進程序結構。
- 改進設計的一個重要方向就是消除重複程式碼。
- 事不過三，三則重構。
- 設計->編碼->重構 能夠有效降低預先設計的壓力，不用為了猜測程式的用途而加入過多不必要的程式碼。

## 狀況
- 重複
> Ex: 同一個類的兩個函數含有相同的表達式。
> Ans: 提煉重複的程式碼。

> Ex: 兩個互為兄弟的子類內含相同表達式。
> Ans: 從兩個類提煉出相同表達式。如果只是類似，把相同的部分獨立提煉出來，並設計一個模板，讓所有函數能夠套用在一個模板上。

> Ex: 兩個不相關的類含有相同表達式。
> Ans: 把它提煉出來，考慮要放在某個類，讓另一個類調用它；或是獨立成一個類，這兩個都去調用它。
- 函數過長
    - 每當感覺需要以註釋來說明點什麼的時候，我們就把需要說明的東西寫進一個獨立函數中，並以其用途命名。
    - 如果提煉後發現可讀性沒有提升，可以搜尋註釋。通常程式碼前方有一行註釋，就是在提醒你可以將這段程式碼替換成一個函數。

## 步驟
1. 為即將重構的程式碼建立測試環境。
    - 生成虛假操作者。
    - 能夠自我檢驗。
2. 找出程式碼的邏輯混亂的地方將之提煉。
    - 先想好安全作法，可用偽代碼。
    - 每次修改的幅度都很小。
3. 找出程序中引用舊函數的地方修改成新函數。
